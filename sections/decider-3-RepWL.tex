% !TeX root = ../bbchallenge-paper.tex

\newpage
\subsection{Repeated Word List (RepWL)}\label{sec:RepWL}

The Repeated Word List (RepWL) technique is based on the following simple idea: if a word (or \textit{block}) of length $l > 0$ appears consecutively on the tape more than $T > 0$ times (with $T, l \in \mathbb{N}$ fixed) then, let's assume it will eventually repeat forever. In practice, it means we represent configurations as regular expressions. For instance, consider the following configuration:

$$ \texttt{0}^\infty \; \texttt{1100 A> 111101010101000000} \; \texttt{0}^\infty$$

Using $l=2$ and $T = 3$, we represent it as (treating $\texttt{0}^\infty$ as implicit border condition):

$$ (\texttt{11})^2 \; (\texttt{00}) \; \texttt{A>} \; (\texttt{11})^2 \; (\texttt{01})^{3+} \; (\texttt{00})^{3+}$$

Where regular expression $(w)^{k+}$ means that the word $w$ is repeated at least $k$ times, with $w \in \{\szero,\sone\}^*$ and $k > 0$. Note that here, we use \textit{directional head notation} for Turing machines, where the head lives in between cells and points either right or left. This framework is equivalent to the Turing machines setup (Appendix~\ref{app:TMs}) used elsewhere in this work.

We now need to deal with two cases: (i) \textit{block simulation} when the head is facing a constant block (\ie block without a $+$), such as $\texttt{A>} \; (\texttt{11})^2$ and (ii) \textit{regex branching} when the head is facing a block with a $+$, \eg $\texttt{B>} \; (\texttt{01})^3+$.

\paragraph{Block simulation.} When the head is facing a constant block, such as in the above example $\texttt{A>} \; (\texttt{11})^2$, we can proceed to \textit{block simulation}. Block simulation consists in simulating the Turing machine until the head potentially eventually leaves the block. We say potentially as the machine could enter a cycle inside the block and never leave it. In practice this is dealt with either using a gas parameter limiting how many steps we're willing to take in block simulation before giving up (option taken in \CoqBB), or to embed a decider for loops in the block simulator (Section~\ref{sec:loops}). For instance, block simulation from $\texttt{A>} \; (\texttt{11})^2$ could produce, for instance, $(\texttt{00})^2 \; \texttt{B>}$ or $\texttt{<C} \; \texttt{10} \; \texttt{11} $ or enter a cycle and never leave the block.

\paragraph{Regex branching.} When the head is facing a block with a $+$, for instance $\texttt{B>} \; (\texttt{01})^{3+}$, we add two configurations to the set of configurations to visit next:
\begin{enumerate}
    \item A configuration where $\texttt{B>} \; (\texttt{01})^{3+}$ is replaced with $\texttt{B>} \; (\texttt{01}) \; (\texttt{01})^{2}$
    \item A configuration where $\texttt{B>} \; (\texttt{01})^{3+}$ is replaced with  $\texttt{B>} \; (\texttt{01}) \; (\texttt{01})^{3+}$
\end{enumerate}
In both case, we've reduced to block simulation.

\paragraph{RepWL decider.} Starting from the initial configuration (\ie $\texttt{A>}$, assuming that $0^\infty$ are treated as implicit border conditions), using block simulation and regex branching, we're creating a graph of regex configurations to explore -- nodes using regex branching have out-degree two. If this graph is eventually closed and contains no halting configuration then we know that the machine will never halt (Theorem~\ref{th:repwl}) since we have constructed a set of configurations bigger than the one it will visit and that does not contain any halting transition. Because there is no guarantee the graph is closed, we also need an additional gas parameter indicating how many distinct nodes we're willing to visit at most.


\begin{algorithm}
    \caption{{\sc decider-RepWL}}\label{alg:RepWL}

    \begin{algorithmic}[1]
        \State{\textbf{Input:} A Turing machine $\mathcal{M}$, block-length parameter $l>0$, minimum size of nonconstant blocks $T>0$, maximum number of steps allowed in block simulation $M \in \mathbb{N}$, maximum number of distinct nodes we're willing to visit $N\in \mathbb{N}$.}
        \State{\textbf{Output:} \NONHALT if the decider detects that the machine doesn't halt and \UNKNOWN otherwise.}
        \State
        \State $\texttt{to\_visit} = [\texttt{A>}]$
        \State $V = \{\}$ \Comment{Visited configurations}
        \State \While{$|V| < N$ \textbf{and} $\texttt{to\_visit}.\textbf{len}() \neq 0$}
        \State $\texttt{config} = \texttt{to\_visit}.\textbf{pop}()$
        \State \If{head in \texttt{config} is facing a constant block}
        \State $\texttt{new\_config} = \texttt{config}.\textbf{block\_simulation}(M)$
        \State heyeeeds
        \EndIf
        \EndWhile



    \end{algorithmic}
\end{algorithm}